{% extends "base.html" %}
{% block content %}
<h1 class="text-2xl font-semibold mb-6">Εγγραφή Φοιτητή</h1>

{# Search section #}
{% if not E2E_TEST_LOGIN %}
<form method="get" class="bg-white shadow-sm border rounded p-6 mb-6">
  <label class="block text-sm text-gray-700 mb-1">Αναζήτηση</label>
  <div class="flex gap-2">
    <input type="text" name="q" value="{{ query }}" placeholder="όνομα χρήστη ή email" class="block w-full rounded border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
    <button type="submit" class="px-4 py-2 bg-gray-800 text-white rounded hover:bg-gray-900">Αναζήτηση</button>
  </div>
</form>

{% if query and results %}
  <div class="bg-white shadow-sm border rounded p-6 mb-6">
    <h2 class="text-lg font-semibold mb-3">Αποτελέσματα</h2>
    <ul class="divide-y">
      {% for u in results %}
        <li class="py-3 flex items-center justify-between">
          <div>
            <div class="font-medium">{{ u.username }}</div>
            <div class="text-sm text-gray-600">{{ u.full_name }} {% if u.email %}· {{ u.email }}{% endif %}</div>
          </div>
          <form method="post">
            {% csrf_token %}
            <input type="hidden" name="username" value="{{ u.username }}" />
            <button type="submit" class="px-3 py-1.5 text-sm bg-indigo-600 text-white rounded hover:bg-indigo-700">Εγγραφή</button>
          </form>
        </li>
      {% endfor %}
    </ul>
  </div>
{% elif query %}
  <div class="bg-white shadow-sm border rounded p-4 mb-6 text-sm text-gray-600">Δεν βρέθηκαν αποτελέσματα.</div>
{% endif %}

{% else %}
{% endif %}

{# Fallback direct username entry when OIDC is disabled #}
{% if E2E_TEST_LOGIN %}
<form method="post" class="bg-white shadow-sm border rounded p-6 space-y-4">
  {% csrf_token %}
  {% if form.non_field_errors %}
    <div class="text-red-600 text-sm">{{ form.non_field_errors }}</div>
  {% endif %}
  <div class="grid gap-1">
    <label class="text-sm text-gray-700">Όνομα χρήστη</label>
    <div class="flex items-start gap-3">
      {{ form.username }}
      {% if form.username.errors %}
        <div class="text-red-600 text-sm">{{ form.username.errors }}</div>
      {% endif %}
    </div>
  </div>
  <div class="pt-2">
    <button type="submit" class="inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700" data-testid="submit-enrollment">Εγγραφή</button>
  </div>
  </form>
{% endif %}
{% endblock %}
